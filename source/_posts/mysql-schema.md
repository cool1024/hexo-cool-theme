---
title: MySQL Schema 优化
date: 2018-09-29 09:13:39
tags: mysql
categories: 数据库
---

### 数据类型
1. **更小通常更好** 尽量使用可以正确存储数据的最小数据类型。更小的数据类型通常更快，因为他们占用更少的磁盘、内存和CPU缓存，并且需要的CPU处理周期也更少（例如只需要存0-200，tinyint unsigned更好）
2. **简单就好** 简单数据类型操作代价更低，（使用MySQL内建类型而不是用字符串来存储日期，使用整型存储IP而不是字符串）
 * inet_aton:将ip地址转换成数字型
 * inet_ntoa:将数字型转换成ip地址
3. **避免使用NULL** 通常情况下最好指定列为NOT NULL,除非真的需要存储NULL值（NULL会让索引，索引统计和值比较变得更复杂，但是对于InnoDB使用了单独的bit存储NULL，对于稀疏的数据有很好的空间效率）
4. 有符号与无符号使用相同的存储空间，并且具有相同的性能，因此可以更具实际情况选择合适的类型（范围不同）
 * tinyint unsigned 0-255
 * tinyint -128-127
5. **DECIMAL** 可以使用BIGINT来代替，decimal需要额外的开销，代价较高
6. **VARCHAR比CHAR更灵活**
7. **BLOG,TEXT避免使用**
8. **应该使用整数作为标识符而不是字符串**
<!--more-->

### Schema陷阱
1. 太多的列
2. 过多的关联
3. 乱用枚举

#### 范式
范式是符合某一种级别的关系模式的集合。关系数据库中的关系必须满足一定的要求，满足不同程度要求的为不同范式。
目前关系数据库有六种范式：第一范式（1NF）、第二范式（2NF）、第三范式（3NF）、Boyce-Codd范式（BCNF）、第四范式（4NF）和第五范式（5NF）。
1. **第一范式（1NF）** 
在任何一个关系数据库中，第一范式（1NF）是对关系模式的基本要求，不满足第一范式（1NF）的数据库就不是关系数据库。
所谓第一范式（1NF）是指数据库表的每一列都是不可分割的基本数据项，同一列中不能有多个值，即实体中的某个属性不能有多个值或者不能有重复的属性。如果出现重复的属性，就可能需要定义一个新的实体，新的实体由重复的属性构成，新实体与原实体之间为一对多关系。在第一范式（1NF）中表的每一行只包含一个实例的信息。
简而言之，第一范式就是无重复的列。
2. **第二范式（2NF）**
数据库表中不存在非关键字段对任一候选关键字段的部分函数依赖（部分函数依赖指的是存在组合关键字中的某些字段决定非关键字段的情况），也即所有非关键字段都完全依赖于任意一组候选关键字。

### 范式化的优与劣
1. 优势
 * 更新操作通常比反范式化快
 * 重复数据较少
 * 表更小，可以更好的放在内存中，执行操作快
 * 加快单表检索

2. 劣势
 * 通常需要关联表，关联表的代价很昂贵，可能使得索引失效
